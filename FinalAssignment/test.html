<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://www.amcharts.com/lib/3/ammap.js"></script>
    <script src="https://www.amcharts.com/lib/3/maps/js/worldLow.js"></script>
    <script src="https://www.amcharts.com/lib/3/themes/none.js"></script>
    <script src="https://www.amcharts.com/lib/3/plugins/export/export.min.js"></script>
    <script src="http://www.amcharts.com/lib/3/plugins/dataloader/dataloader.min.js" type="text/javascript"></script>

    <link rel="stylesheet" href="https://www.amcharts.com/lib/3/plugins/export/export.css" type="text/css" media="all"/>
    <style>
        #chartdiv {
            width: 100%;
            height: 500px;
        }
    </style>

</head>
<body>

<input type="button" value="Select dataset #1" onclick="setDataset(0);"/>
<input type="button" value="Select dataset #2" onclick="setDataset(1);"/>
<input type="button" value="Select dataset #3" onclick="setDataset(2);"/>

<div id="chartdiv"></div>
<script>


    var map;
    var dataSets;

    AmCharts.loadFile("data/rubella_2.csv", {}, function (response) {
        /**
         * Parse loaded CSV
         */
        var mapData = AmCharts.parseCSV(response, {
            "separator": ",",
            "useColumnNames": true,
            "numberFields": ["value"]
        });


        var areas = [];
        for (var i = 0; i < mapData.length; i++) {
            var dataItem = mapData[i];
            var value = dataItem[2016];
            var id = dataItem.ISO2;

            areas.push({
                id: id,
                value: value
            })
        }


        map = AmCharts.makeChart("chartdiv", {

            "type": "map",
            "theme": "none",
            "projection": "miller",
            "colorSteps": 5,

//
//        "dataProvider": {
//            "map": "worldLow",
//            "getAreasFromMap": true,
//
//            "areas": [ {
//                //"title": "Germany",
//                "id": "AUS",
//                "color": "#67b7dc",
//                "customData": "1995",
//            },
//            ]
//        },
            // "dataProvider": dataProvider,
            "dataProvider": {
                "map": "worldLow",
                "areas": areas
            },

            "areasSettings": {
                "autoZoom": true,
                "selectedColor": "#CC0000"
            },
            "smallMap": {},
            "export": {
                "enabled": true,
                "position": "bottom-right"
            },
            "dataSets": [{
                "dataLoader": {
                    "url": "data/rubella.csv",
                    "format": "csv",
                    "delimiter": ",",       // column separator
                    "useColumnNames": true, // use first row for column names
                    "skip": 1               // skip header row
                }
            }],
//            "valueLegend": {
//                right: 10,
//                minValue: "little",
//                maxValue: "a lot!"
//            }
        });

    });

    function setDataset(index) {
        map.dataProvider.areas = dataSets[Number(index)];
        map.validateData();
    }


</script>

</body>
</html>